
-- Create the salaryoverview table
CREATE TABLE IF NOT EXISTS public.salaryoverview
(
    salaryoverviewid SERIAL constraint salaryoverview_pk primary key,
    employeesid integer unique constraint salaryoverview_employeeslist_employeesid_fk references public.employeeslist,
    username varchar(30),
    email varchar(50),
    position varchar(50),
    organization varchar(50),
    salary integer,
    taxdeduction integer,
    total integer,
    image varchar(255)
);

-- Change the owner of the table to postgres (if needed)
ALTER TABLE public.salaryoverview
OWNER TO postgres;

-- Create a function to calculate taxdeduction and total
CREATE OR REPLACE FUNCTION public.calculate_tax_and_total()
RETURNS TRIGGER AS $$
BEGIN
    NEW.taxdeduction = NEW.salary * 0.13;
    NEW.total = NEW.salary - NEW.taxdeduction;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Create a trigger to execute the function before insert
CREATE TRIGGER before_insert_salaryoverview
BEFORE INSERT ON public.salaryoverview
FOR EACH ROW
EXECUTE FUNCTION public.calculate_tax_and_total();